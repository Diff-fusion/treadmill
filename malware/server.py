#!/usr/bin/python3

import socket

xor = lambda a, b: bytes(aa ^ bb for aa, bb in zip(a, b))

with socket.create_server(('0.0.0.0', 1337)) as srv:
    while (inbound := srv.accept()):
        so, _ = inbound
        message = so.recv(0x100)
        key = int.from_bytes(message[:8], 'little')
        ciphertext = message[8:]
        length = len(ciphertext)
        if length % 8:
            ciphertext = ciphertext.ljust(length + 8 - length % 8, b'\0')
        ciphertext = bytearray(ciphertext)
        for offset in range(len(ciphertext) - 8, -1, -8):
            key *= 2131131137
            key &= 0xFFFFFFFFFFFFFFFF
            ciphertext[offset:offset + 8] = xor(ciphertext[offset:offset + 8], key.to_bytes(8, 'little'))
        print((ciphertext[:length]).decode())
