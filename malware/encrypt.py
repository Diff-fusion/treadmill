import os
data = bytearray(open("payload.bin", "rb").read())

"""
inline uint8_t gen_key(uint64_t key1, uint64_t key2, uint64_t offset) {
    uint8_t x = key1 >> (offset & 0x3F);
    return x ^ (key2 >> (offset >> 6));
}
"""

K1 = 0xb7da92e68673dbaa
K2 = 0x817658c1e735bc9b

def gen_key(k1, k2, off):
    x = k1 >> (off & 0x3F)
    return (x ^ (k2 >> (off >> 6))) & 0xFF

for i in range(333):
    data[i] ^= gen_key(K1, K2, i)

# fill the rest with garbage
for i in range(333, len(data)):
    if data[i] == 0:
        data[i] = os.urandom(1)[0]

open("payload.bin", "wb").write(data)
